"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[9059],{23623(e,s,n){n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>t,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"client-sdk/python-sdk/ros2-example","title":"ROS2 Example (Advanced Users)","description":"This example demonstrates how to integrate Aria SDK with ROS2 to publish and subscribe to Aria device data using custom ROS2 messages. You\'ll learn how to create custom ROS2 message types, stream Aria sensor data through ROS2 topics, and process the data in subscriber nodes.","source":"@site/docs-ark/client-sdk/python-sdk/ros2-example.mdx","sourceDirName":"client-sdk/python-sdk","slug":"/client-sdk/python-sdk/ros2-example","permalink":"/projectaria_tools/gen2/ark/client-sdk/python-sdk/ros2-example","draft":false,"unlisted":false,"editUrl":"https://www.internalfb.com/code/fbsource/arvr/projects/ariane/aria_research_kit/projectaria_tools/website/docs-ark/client-sdk/python-sdk/ros2-example.mdx","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"sidebar_position":6,"title":"ROS2 Example (Advanced Users)"},"sidebar":"arkSidebar","previous":{"title":"Text-to-Speech Example","permalink":"/projectaria_tools/gen2/ark/client-sdk/python-sdk/text-to-speech-example"},"next":{"title":"Remote Streaming","permalink":"/projectaria_tools/gen2/ark/client-sdk/remote-streaming"}}');var r=n(74848),a=n(28453);const l={sidebar_position:6,title:"ROS2 Example (Advanced Users)"},t="ROS2 Integration Example (Advanced Users)",c={},d=[{value:"Overview",id:"overview",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Setup Steps",id:"setup-steps",level:2},{value:"Step 1: Extract SDK Examples and Create Custom ROS2 Message Type",id:"step-1-extract-sdk-examples-and-create-custom-ros2-message-type",level:3},{value:"Extract SDK Example Code",id:"extract-sdk-example-code",level:4},{value:"Understanding the Custom Message Type",id:"understanding-the-custom-message-type",level:4},{value:"Create the Custom Message Package",id:"create-the-custom-message-package",level:4},{value:"Step 2: Create Your Python ROS2 Package",id:"step-2-create-your-python-ros2-package",level:3},{value:"Replace Publisher and Subscriber Code",id:"replace-publisher-and-subscriber-code",level:4},{value:"Step 3: Configure Dependencies",id:"step-3-configure-dependencies",level:3},{value:"Update package.xml",id:"update-packagexml",level:4},{value:"Step 4: Build and Run the Example",id:"step-4-build-and-run-the-example",level:3},{value:"Build the Python Package",id:"build-the-python-package",level:4},{value:"Run the Talker (Publisher)",id:"run-the-talker-publisher",level:4},{value:"Run the Listener (Subscriber)",id:"run-the-listener-subscriber",level:4},{value:"Code Walkthrough",id:"code-walkthrough",level:2},{value:"Publisher Code Explanation",id:"publisher-code-explanation",level:3},{value:"1. Import Required Modules",id:"1-import-required-modules",level:4},{value:"2. Setup Device Streaming Function",id:"2-setup-device-streaming-function",level:4},{value:"3. MinimalPublisher Class - Initialization",id:"3-minimalpublisher-class---initialization",level:4},{value:"4. Calibration Publisher Callback",id:"4-calibration-publisher-callback",level:4},{value:"5. Device Calibration Callback",id:"5-device-calibration-callback",level:4},{value:"6. Raw Message Callback",id:"6-raw-message-callback",level:4},{value:"7. Setup Streaming Receiver",id:"7-setup-streaming-receiver",level:4},{value:"8. Main Function",id:"8-main-function",level:4},{value:"Subscriber Code Explanation",id:"subscriber-code-explanation",level:3},{value:"1. Import Required Modules",id:"1-import-required-modules-1",level:4},{value:"2. Setup Data Converter and Global State",id:"2-setup-data-converter-and-global-state",level:4},{value:"3. Raw Message Processing Function",id:"3-raw-message-processing-function",level:4},{value:"4. Image Data Processing",id:"4-image-data-processing",level:4},{value:"5. IMU Data Processing",id:"5-imu-data-processing",level:4},{value:"6. Other Sensor Types",id:"6-other-sensor-types",level:4},{value:"7. MinimalSubscriber Class",id:"7-minimalsubscriber-class",level:4},{value:"8. Listener Callback",id:"8-listener-callback",level:4},{value:"9. Calibration Callback",id:"9-calibration-callback",level:4},{value:"10. Main Function",id:"10-main-function",level:4},{value:"Data Flow",id:"data-flow",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"No Data in Subscriber",id:"no-data-in-subscriber",level:3},{value:"Port 6768 Already in Use",id:"port-6768-already-in-use",level:3},{value:"Subscriber Not Processing Messages",id:"subscriber-not-processing-messages",level:3},{value:"High Message Drop Rate",id:"high-message-drop-rate",level:3},{value:"Publisher and Subscriber Cannot Communicate",id:"publisher-and-subscriber-cannot-communicate",level:3},{value:"Related Resources",id:"related-resources",level:2}];function o(e){const s={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.header,{children:(0,r.jsx)(s.h1,{id:"ros2-integration-example-advanced-users",children:"ROS2 Integration Example (Advanced Users)"})}),"\n",(0,r.jsx)(s.p,{children:"This example demonstrates how to integrate Aria SDK with ROS2 to publish and subscribe to Aria device data using custom ROS2 messages. You'll learn how to create custom ROS2 message types, stream Aria sensor data through ROS2 topics, and process the data in subscriber nodes."}),"\n",(0,r.jsx)(s.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsx)(s.p,{children:"The ROS2 integration allows you to:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Stream raw Aria sensor data through ROS2 topics"}),"\n",(0,r.jsx)(s.li,{children:"Share device calibration data across ROS2 nodes"}),"\n",(0,r.jsx)(s.li,{children:"Process sensor data using standard ROS2 tools and workflows"}),"\n",(0,r.jsx)(s.li,{children:"Build distributed robotics systems using Aria sensors"}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"ROS2 installed (Humble or later)"}),"\n",(0,r.jsx)(s.li,{children:"Aria SDK Python package installed"}),"\n",(0,r.jsx)(s.li,{children:"Basic familiarity with ROS2 concepts (nodes, topics, messages)"}),"\n",(0,r.jsx)(s.li,{children:"C++ compiler for building custom message types"}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"setup-steps",children:"Setup Steps"}),"\n",(0,r.jsx)(s.admonition,{title:"ROS2 Environment Setup Required",type:"caution",children:(0,r.jsxs)(s.p,{children:["Before proceeding, ensure you have ROS2 properly installed and configured in your development environment. You should have a ROS2 workspace set up (e.g., ",(0,r.jsx)(s.code,{children:"~/ros2_ws"}),") and be able to source the ROS2 setup files. If you haven't set up ROS2 yet, please follow the ",(0,r.jsx)(s.a,{href:"https://docs.ros.org/en/humble/Installation.html",children:"ROS2 installation guide"})," for your operating system."]})}),"\n",(0,r.jsx)(s.h3,{id:"step-1-extract-sdk-examples-and-create-custom-ros2-message-type",children:"Step 1: Extract SDK Examples and Create Custom ROS2 Message Type"}),"\n",(0,r.jsx)(s.h4,{id:"extract-sdk-example-code",children:"Extract SDK Example Code"}),"\n",(0,r.jsx)(s.p,{children:"First, extract the ROS2 example code from the Aria SDK:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"python3 -m aria.extract_sdk_samples --out ~/Downloads\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"What this does:"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Extracts all SDK example scripts to ",(0,r.jsx)(s.code,{children:"~/Downloads/projectaria_client_sdk_samples_gen2/"})]}),"\n",(0,r.jsxs)(s.li,{children:["Includes ",(0,r.jsx)(s.code,{children:"AriaRaw.msg"}),", ",(0,r.jsx)(s.code,{children:"ros2_publisher_example.py"})," and ",(0,r.jsx)(s.code,{children:"ros2_subscriber_example.py"})]}),"\n",(0,r.jsx)(s.li,{children:"Also includes other example scripts (device_streaming.py, etc.)"}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h4,{id:"understanding-the-custom-message-type",children:"Understanding the Custom Message Type"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"What is AriaRaw?"})}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.code,{children:"AriaRaw"})," is a custom ROS2 message type specifically designed to transport Aria sensor data through ROS2 topics. Unlike standard ROS2 messages (like ",(0,r.jsx)(s.code,{children:"sensor_msgs/Image"})," or ",(0,r.jsx)(s.code,{children:"sensor_msgs/Imu"}),"), AriaRaw is a minimal wrapper that carries raw binary sensor data in its native format."]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Why do we need a custom message type?"})}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Preserves original data format"}),": Aria devices stream data in FlatBuffer format, which is highly efficient and compact. Using a custom message preserves this efficiency rather than converting to standard ROS2 formats."]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Handles diverse sensor types"}),": Aria devices have many sensors (4 SLAM cameras, 2 ET cameras, 1 RGB camera, IMU, magnetometer, barometer, etc.). A single flexible message type can carry data from all sensors rather than creating publisher/subscriber pairs for each sensor type."]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Future-proof"}),": New sensor types or perception outputs (VIO, eye gaze, hand tracking) can be added without changing the ROS2 message interface."]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Maintains timing accuracy"}),": Raw binary transport ensures nanosecond-precision timestamps aren't lost in format conversions."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"The subscriber side uses the Aria SDK's data converter to decode the raw payload into typed Python objects (NumPy arrays for images, structured data for IMU, etc.)."}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Custom message:"})," ",(0,r.jsx)(s.code,{children:"AriaRaw.msg"})]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-msg",children:"int64 id\nuint8[] payload\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Message Fields:"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"id"}),": The message type identifier from the Aria SDK (indicates sensor type)"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"payload"}),": Raw binary data containing the sensor information in Flatbuffer format"]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"AriaRaw.msg is prepackaged into the example code and can be accessed from"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"cat ~/Downloads/projectaria_client_sdk_samples_gen2/AriaRaw.msg\n"})}),"\n",(0,r.jsx)(s.h4,{id:"create-the-custom-message-package",children:"Create the Custom Message Package"}),"\n",(0,r.jsxs)(s.p,{children:["Follow the ",(0,r.jsx)(s.a,{href:"https://docs.ros.org/en/foxy/Tutorials/Beginner-Client-Libraries/Single-Package-Define-And-Use-Interface.html",children:"ROS2 tutorial for creating custom messages"})," to create a C++ package for the custom message definition."]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsxs)(s.strong,{children:["Important: The package MUST be named ",(0,r.jsx)(s.code,{children:"aria_data_types"})]})}),"\n",(0,r.jsx)(s.p,{children:"This exact package name is required because the publisher and subscriber example code import the custom message using:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-python",children:"from aria_data_types.msg import AriaRaw\n"})}),"\n",(0,r.jsx)(s.p,{children:"If you use a different package name, the example code will fail with import errors."}),"\n",(0,r.jsx)(s.admonition,{title:"Build Order",type:"tip",children:(0,r.jsxs)(s.p,{children:["Build the ",(0,r.jsx)(s.code,{children:"aria_data_types"})," message package first before building the Python publisher/subscriber package. The Python package depends on the custom message types being available."]})}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h3,{id:"step-2-create-your-python-ros2-package",children:"Step 2: Create Your Python ROS2 Package"}),"\n",(0,r.jsxs)(s.p,{children:["Create your own Python ROS2 package for publisher and subscriber nodes following the ",(0,r.jsx)(s.a,{href:"https://docs.ros.org/en/foxy/Tutorials/Beginner-Client-Libraries/Writing-A-Simple-Py-Publisher-And-Subscriber.html",children:"ROS2 Python publisher/subscriber tutorial"}),", then replace the default code with the Aria ROS2 examples."]}),"\n",(0,r.jsx)(s.h4,{id:"replace-publisher-and-subscriber-code",children:"Replace Publisher and Subscriber Code"}),"\n",(0,r.jsxs)(s.p,{children:["After creating your Python ROS2 package (e.g., ",(0,r.jsx)(s.code,{children:"py_pubsub"}),") with publisher and subscriber nodes, replace the default code with the Aria ROS2 examples:"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"# Navigate to your ROS2 package\ncd ~/ros2_ws/src/py_pubsub/py_pubsub\n\n# Copy the ROS2 publisher example\ncp ~/Downloads/projectaria_client_sdk_samples_gen2/ros2_publisher_example.py publisher_member_function.py\n\n# Copy the ROS2 subscriber example\ncp ~/Downloads/projectaria_client_sdk_samples_gen2/ros2_subscriber_example.py subscriber_member_function.py\n"})}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Note:"})," The file names ",(0,r.jsx)(s.code,{children:"publisher_member_function.py"})," and ",(0,r.jsx)(s.code,{children:"subscriber_member_function.py"})," should match the entry points defined in your ",(0,r.jsx)(s.code,{children:"setup.py"})," when you created the package."]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h3,{id:"step-3-configure-dependencies",children:"Step 3: Configure Dependencies"}),"\n",(0,r.jsxs)(s.p,{children:["Before building, configure the package dependencies to include the custom ",(0,r.jsx)(s.code,{children:"aria_data_types"})," message package."]}),"\n",(0,r.jsx)(s.h4,{id:"update-packagexml",children:"Update package.xml"}),"\n",(0,r.jsxs)(s.p,{children:["Edit the ",(0,r.jsx)(s.code,{children:"package.xml"})," file in your ",(0,r.jsx)(s.code,{children:"py_pubsub"})," package to add the dependency on ",(0,r.jsx)(s.code,{children:"aria_data_types"}),":"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"cd ~/ros2_ws/src/py_pubsub\n"})}),"\n",(0,r.jsxs)(s.p,{children:["Add the following line to ",(0,r.jsx)(s.code,{children:"package.xml"})," in the dependencies section:"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-xml",children:"<exec_depend>aria_data_types</exec_depend>\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Why this is needed:"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Declares that ",(0,r.jsx)(s.code,{children:"py_pubsub"})," depends on the ",(0,r.jsx)(s.code,{children:"aria_data_types"})," message package"]}),"\n",(0,r.jsxs)(s.li,{children:["Ensures ROS2 can find the custom ",(0,r.jsx)(s.code,{children:"AriaRaw"})," message type at runtime"]}),"\n",(0,r.jsx)(s.li,{children:"Without this dependency, the nodes will fail to import the custom message"}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h3,{id:"step-4-build-and-run-the-example",children:"Step 4: Build and Run the Example"}),"\n",(0,r.jsx)(s.h4,{id:"build-the-python-package",children:"Build the Python Package"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"# Return to workspace root\ncd ~/ros2_ws\n\n# Build the package\ncolcon build --packages-select py_pubsub\n"})}),"\n",(0,r.jsx)(s.p,{children:"This compiles the package and prepares it for execution."}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.p,{children:"Now that the packages are built, you can run the publisher and subscriber nodes to stream and process Aria sensor data."}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Important:"})," Before running the nodes, ensure both terminals use the same ROS_DOMAIN_ID so they can communicate with each other:"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"export ROS_DOMAIN_ID=0\n"})}),"\n",(0,r.jsx)(s.p,{children:"Add this command to both terminals before running the nodes. This ensures the publisher and subscriber are on the same ROS2 domain and can discover each other."}),"\n",(0,r.jsx)(s.h4,{id:"run-the-talker-publisher",children:"Run the Talker (Publisher)"}),"\n",(0,r.jsx)(s.p,{children:"In another terminal, start the talker:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"source install/setup.bash\nros2 run py_pubsub talker\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"What happens:"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Connects to Aria device via USB"}),"\n",(0,r.jsx)(s.li,{children:"Starts streaming sensor data"}),"\n",(0,r.jsx)(s.li,{children:"Publishes calibration and raw sensor messages to ROS2 topics"}),"\n",(0,r.jsx)(s.li,{children:"Subscriber receives and processes the data"}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Example Publisher Output:"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"[INFO] [1746238590305.2341235] [minimal_publisher]: Received message: ID=SLAM_CAMERA_FRAME, payload length=114353\n[INFO] [1746238590315.4567890] [minimal_publisher]: Received message: ID=IMU_EVENT, payload length=4896\n[INFO] [1746238590335.1234567] [minimal_publisher]: Received message: ID=MP_VIO_RESULT, payload length=2048\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Log Explanation:"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Payload length"}),": Size of the raw sensor data in bytes"]}),"\n",(0,r.jsx)(s.li,{children:"Messages are logged as they arrive from the Aria device and published to ROS2"}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h4,{id:"run-the-listener-subscriber",children:"Run the Listener (Subscriber)"}),"\n",(0,r.jsx)(s.p,{children:"In one terminal, start the listener:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"source install/setup.bash\nros2 run py_pubsub listener\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"What happens:"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Subscriber node starts and waits for messages"}),"\n",(0,r.jsxs)(s.li,{children:["Listens on ",(0,r.jsx)(s.code,{children:"aria_raw_message"})," and ",(0,r.jsx)(s.code,{children:"calibration"})," topics"]}),"\n",(0,r.jsx)(s.li,{children:"Will begin processing data once publisher starts"}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Example Listener Output:"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"[Calibration] Received device calibration\n[Calibration] Calibration set in converter - VIO, eye gaze, and hand pose decoding enabled\n[IMU] Accel: [9.594, 2.151, 0.401] m/s\xb2, Gyro: [-0.001, 0.003, 0.002] rad/s, Timestamp: 5045688456090 ns, Count: 16 samples\n[SLAM Camera] Size: 512x512, Timestamp: 5046068223788 ns, Camera ID: 4\n[VIO] timestamp 5048468222100 with transform_odometry_bodyimu: [[-2.9847002e-01 -1.5660522e+00  6.5189652e-04]] and [[ 0.00011986 -0.00025058  0.00013689]] ns\n[RGB Camera] Size: 2016x1512, Timestamp: 5048213203431 ns, Camera ID: 64\n[IMU] Accel: [9.601, 2.148, 0.405] m/s\xb2, Gyro: [-0.002, 0.002, 0.001] rad/s, Timestamp: 5045788456090 ns, Count: 16 samples\n[SLAM Camera] Size: 512x512, Timestamp: 5046168223788 ns, Camera ID: 1\n[Eye Gaze] Yaw: 0.124 rad, Pitch: -0.056 rad, Depth: 1.234 m, Timestamp: 5048.468 s\n[Hand Tracking] Left hand: detected, Right hand: not detected, Timestamp: 5048.512 s\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Output Explanation:"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Calibration"}),": First message received, enables VIO/eye gaze/hand tracking conversion"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"IMU"}),": High-frequency accelerometer (m/s\xb2) and gyroscope (rad/s) measurements"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"SLAM Camera"}),": Monochrome tracking camera frames with Camera ID (4 cameras total)"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"RGB Camera"}),": Color camera frames at high resolution"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"VIO"}),": Visual-Inertial Odometry with rotation (log space) and translation vectors"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Eye Gaze"}),": Gaze direction in yaw/pitch angles and focus depth"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Hand Tracking"}),": Hand detection status for left and right hands"]}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"code-walkthrough",children:"Code Walkthrough"}),"\n",(0,r.jsx)(s.p,{children:"This section provides a detailed explanation of how the publisher and subscriber code works."}),"\n",(0,r.jsx)(s.h3,{id:"publisher-code-explanation",children:"Publisher Code Explanation"}),"\n",(0,r.jsx)(s.p,{children:"The publisher node connects to an Aria device, receives streaming data, and publishes it to ROS2 topics."}),"\n",(0,r.jsx)(s.h4,{id:"1-import-required-modules",children:"1. Import Required Modules"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-python",children:"import aria.sdk_gen2 as sdk_gen2\nimport aria.stream_receiver as receiver\nimport rclpy\n\nfrom aria_data_types.msg import AriaRaw\nfrom projectaria_tools.core import calibration\nfrom rclpy.node import Node\nfrom std_msgs.msg import String\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"What these imports do:"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"aria.sdk_gen2"}),": Core SDK for device connection and configuration"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"aria.stream_receiver"}),": Receives streaming data from Aria device over HTTP"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"rclpy"}),": ROS2 Python client library"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"aria_data_types.msg.AriaRaw"}),": Custom ROS2 message type for raw sensor data"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"projectaria_tools.core.calibration"}),": Tools for working with device calibration"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"std_msgs.msg.String"}),": Standard ROS2 string message for calibration data"]}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h4,{id:"2-setup-device-streaming-function",children:"2. Setup Device Streaming Function"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-python",children:'def device_streaming():\n    # Set up the device client config\n    config = sdk_gen2.DeviceClientConfig()\n    device_client.set_client_config(config)\n    device = device_client.connect()\n\n    # Set streaming config with profile name\n    streaming_config = sdk_gen2.HttpStreamingConfig()\n    streaming_config.profile_name = "profile9"\n    streaming_config.streaming_interface = sdk_gen2.StreamingInterface.USB_NCM\n    device.set_streaming_config(streaming_config)\n\n    # Start streaming\n    device.start_streaming()\n    return device\n'})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"What this function does:"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Connects to Aria device"})," via USB (first available device if not specified)"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Configures streaming profile"}),' ("profile9" - a predefined sensor configuration)']}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Sets interface to USB_NCM"})," (Network Control Model for USB communication)"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Starts streaming"})," and returns the device handle"]}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Streaming Profiles:"})," Different profiles capture different combinations of sensors (cameras, IMU, etc.) at varying frequencies."]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h4,{id:"3-minimalpublisher-class---initialization",children:"3. MinimalPublisher Class - Initialization"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-python",children:'class MinimalPublisher(Node):\n    def __init__(self):\n        super().__init__("minimal_publisher")\n        self.event_pub = self.create_publisher(AriaRaw, "aria_raw_message", 1000)\n        self.timer_pub = self.create_publisher(String, "calibration", 100)\n        self.timer_period = 0.1  # 10 Hz\n        self.timer = self.create_timer(self.timer_period, self.calib_publisher_callback)\n        self.calib_msg = None\n        self.setup_streaming_receiver()\n'})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"What happens during initialization:"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Creates ROS2 node"}),' named "minimal_publisher"']}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Creates two publishers:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"event_pub"}),": Publishes raw sensor data on topic ",(0,r.jsx)(s.code,{children:"aria_raw_message"})," (queue size: 1000)"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"timer_pub"}),": Publishes calibration on topic ",(0,r.jsx)(s.code,{children:"calibration"})," (queue size: 100)"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Sets up periodic timer"})," at 10 Hz to republish calibration data"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Initializes calibration message"})," as ",(0,r.jsx)(s.code,{children:"None"})," (will be set when received from device)"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Sets up streaming receiver"})," to receive data from Aria device"]}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Why publish calibration periodically?"})," Ensures late-joining subscribers receive calibration data needed to decode sensor messages."]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h4,{id:"4-calibration-publisher-callback",children:"4. Calibration Publisher Callback"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-python",children:'def calib_publisher_callback(self):\n    # publish calibration periodically\n    if self.calib_msg is not None:\n        self.timer_pub.publish(self.calib_msg)\n        self.get_logger().info(\n            f"Published calibration on periodic_topic: /calibration"\n        )\n'})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"What this does:"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Runs every 100ms"})," (10 Hz) via timer"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Checks if calibration received"})," from device"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Publishes calibration"})," to ",(0,r.jsx)(s.code,{children:"/calibration"})," topic if available"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Logs publication"})," for debugging"]}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h4,{id:"5-device-calibration-callback",children:"5. Device Calibration Callback"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-python",children:"def stream_receiver_device_calib_callback(self, device_calib):\n    # set the calibration message\n    self.calib_msg = String()\n    self.calib_msg.data = calibration.device_calibration_to_json_string(\n        device_calib\n    )\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"What this does:"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Called once"})," when device sends calibration data (usually on first connection)"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Converts calibration object to JSON string"})," using ProjectAria tools"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Stores in ROS2 String message"})," for publishing"]}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Calibration data includes:"})," Camera intrinsics/extrinsics, IMU calibration, sensor-to-sensor transformations"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h4,{id:"6-raw-message-callback",children:"6. Raw Message Callback"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-python",children:'def stream_receiver_raw_message_callback(self, message, offset):\n    ros2_msg = AriaRaw()\n    ros2_msg.id = message.id\n    ros2_msg.payload = message.payload.as_memoryview()\n    self.event_pub.publish(ros2_msg)\n    self.get_logger().info(\n        f"Received and published message: ID={sdk_gen2.MessageType.to_string(ros2_msg.id)}, payload length={len(ros2_msg.payload)}"\n    )\n'})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"What this does:"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Called for every sensor message"})," from device (images, IMU, etc.)"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Creates AriaRaw ROS2 message"})," with message ID and payload"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Converts payload to memoryview"})," for efficient data transfer"]}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.strong,{children:"Publishes to aria_raw_message topic"})}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Logs message type and size"})," using message ID lookup"]}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Message IDs:"})," Each sensor has a unique ID (e.g., ",(0,r.jsx)(s.code,{children:"0x8010"})," = SLAM camera, ",(0,r.jsx)(s.code,{children:"0x8020"})," = IMU)"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h4,{id:"7-setup-streaming-receiver",children:"7. Setup Streaming Receiver"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-python",children:'def setup_streaming_receiver(self):\n    # setup the server to receive streaming data from the device\n    config = sdk_gen2.HttpServerConfig()\n    config.address = "0.0.0.0"  # Listen on all interfaces\n    config.port = 6768\n\n    # setup the receiver\n    stream_receiver = receiver.StreamReceiver(\n        enable_image_decoding=True, enable_raw_stream=True\n    )\n    stream_receiver.set_server_config(config)\n\n    # register callbacks for each type of data\n    stream_receiver.register_device_calib_callback(\n        self.stream_receiver_device_calib_callback\n    )\n    stream_receiver.register_raw_message_callback(\n        self.stream_receiver_raw_message_callback\n    )\n    # start the server\n    stream_receiver.start_server()\n'})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"What this does:"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Creates HTTP server"})," listening on port 6768 (all network interfaces)"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Enables image decoding"})," for camera frames"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Enables raw stream"})," to receive all message types"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Registers callbacks:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Device calibration \u2192 ",(0,r.jsx)(s.code,{children:"stream_receiver_device_calib_callback"})]}),"\n",(0,r.jsxs)(s.li,{children:["Raw messages \u2192 ",(0,r.jsx)(s.code,{children:"stream_receiver_raw_message_callback"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Starts server"})," to begin receiving data from device"]}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Data flow:"})," Aria device \u2192 HTTP POST to localhost:6768 \u2192 Callbacks triggered \u2192 Data published to ROS2"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h4,{id:"8-main-function",children:"8. Main Function"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-python",children:"def main(args=None):\n    rclpy.init(args=args)\n    device = device_streaming()\n    minimal_publisher = MinimalPublisher()\n    rclpy.spin(minimal_publisher)\n    minimal_publisher.destroy_node()\n    rclpy.shutdown()\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Execution order:"})}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Initialize ROS2"})," Python client library"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Connect to device and start streaming"})," via ",(0,r.jsx)(s.code,{children:"device_streaming()"})]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Create publisher node"})," which sets up HTTP server"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Spin node"})," - keeps node running and processing callbacks"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Cleanup"})," when interrupted (Ctrl+C)"]}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h3,{id:"subscriber-code-explanation",children:"Subscriber Code Explanation"}),"\n",(0,r.jsx)(s.p,{children:"The subscriber node receives sensor data from ROS2 topics, converts raw messages to typed data, and processes them."}),"\n",(0,r.jsx)(s.h4,{id:"1-import-required-modules-1",children:"1. Import Required Modules"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-python",children:"import aria.oss_data_converter as data_converter\nimport aria.sdk_gen2 as sdk_gen2\nimport rclpy\n\nfrom aria_data_types.msg import AriaRaw\nfrom rclpy.node import Node\nfrom std_msgs.msg import String\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"What these imports do:"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"aria.oss_data_converter"}),": Converts raw flatbuffer messages to Python objects"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"aria.sdk_gen2"}),": SDK for message type constants"]}),"\n",(0,r.jsx)(s.li,{children:"Other imports same as publisher"}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h4,{id:"2-setup-data-converter-and-global-state",children:"2. Setup Data Converter and Global State"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-python",children:"converter = data_converter.OssDataConverter()\ncalibration_received = False\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"What this does:"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Creates converter instance"})," to decode raw sensor data"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Tracks calibration state"})," - must receive calibration before processing VIO/eye gaze/hand tracking"]}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Why global?"})," Shared between callback functions to coordinate calibration state"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h4,{id:"3-raw-message-processing-function",children:"3. Raw Message Processing Function"}),"\n",(0,r.jsxs)(s.p,{children:["The ",(0,r.jsx)(s.code,{children:"raw_message_callback"})," function is the core processing logic. It handles different message types:"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-python",children:'def raw_message_callback(raw_message: AriaRaw):\n    if raw_message.payload is None:\n        print("No payload received, cannot decode this message")\n        return\n\n    message = sdk_gen2.SharedMessage(raw_message.id, raw_message.payload)\n    message_id = raw_message.id\n'})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Initial processing:"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Checks for valid payload"})," (some message types may have empty payloads)"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Reconstructs SharedMessage"})," from ROS2 AriaRaw message"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Extracts message ID"})," for type checking"]}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h4,{id:"4-image-data-processing",children:"4. Image Data Processing"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-python",children:'if message_id == sdk_gen2.MessageType.SLAM_CAMERA_FRAME:\n    image_data, image_record = converter.to_image_data_and_record(message)\n    if image_data is not None:\n        print(\n            f"[SLAM Camera] Size: {image_data.get_width()}x{image_data.get_height()}, "\n            f"Timestamp: {image_record.capture_timestamp_ns} ns, "\n            f"Camera ID: {image_record.camera_id}"\n        )\n'})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Handles three camera types:"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"SLAM cameras"})," (4 monochrome tracking cameras at 512x512)"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"ET cameras"})," (2 eye-tracking cameras)"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"POV/RGB camera"})," (single color camera at 2016x1512)"]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Conversion result:"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"image_data"}),": NumPy array with pixel data"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"image_record"}),": Metadata (timestamp, camera ID, exposure, etc.)"]}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h4,{id:"5-imu-data-processing",children:"5. IMU Data Processing"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-python",children:'elif message_id == sdk_gen2.MessageType.IMU_EVENT:\n    imu_data_list = converter.to_imu(message)\n    if imu_data_list is not None and len(imu_data_list) > 0:\n        imu_data = imu_data_list[0]\n        print(\n            f"[IMU] Accel: [{imu_data.accel_msec2[0]:.3f}, {imu_data.accel_msec2[1]:.3f}, {imu_data.accel_msec2[2]:.3f}] m/s\xb2, "\n            f"Gyro: [{imu_data.gyro_radsec[0]:.3f}, {imu_data.gyro_radsec[1]:.3f}, {imu_data.gyro_radsec[2]:.3f}] rad/s, "\n            f"Timestamp: {imu_data.capture_timestamp_ns} ns, "\n            f"Count: {len(imu_data_list)} samples"\n        )\n'})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"IMU messages contain:"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Accelerometer data"})," in m/s\xb2 (3-axis)"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Gyroscope data"})," in rad/s (3-axis)"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Multiple samples"})," per message (batched for efficiency)"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"High frequency:"})," ~1kHz sampling rate"]}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h4,{id:"6-other-sensor-types",children:"6. Other Sensor Types"}),"\n",(0,r.jsx)(s.p,{children:"The callback also handles:"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Environmental sensors:"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-python",children:"# Barometer - atmospheric pressure and temperature\nelif message_id == sdk_gen2.MessageType.BARO_EVENT:\n    baro_data = converter.to_barometer(message)\n    # pressure in Pascals, temperature in Celsius\n\n# Magnetometer - magnetic field\nelif message_id == sdk_gen2.MessageType.MAG_EVENT:\n    mag_data_list = converter.to_magnetometer(message)\n    # magnetic field in Tesla (3-axis)\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Location sensors:"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-python",children:"# GNSS - GPS position data\nelif message_id == sdk_gen2.MessageType.GNSS_EVENT:\n    gnss_data = converter.to_gnss(message)\n    # latitude, longitude, altitude, accuracy\n\n# Phone location - companion phone position\nelif message_id == sdk_gen2.MessageType.PHONE_LOCATION_DATA:\n    phone_location = converter.to_phone_location(message)\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Perception outputs:"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-python",children:"# Eye gaze - where user is looking\nelif message_id == sdk_gen2.MessageType.MP_ET_RESULT:\n    eyegaze_data = converter.to_eye_gaze(message)\n    # yaw, pitch angles and depth\n\n# Hand tracking - hand pose detection\nelif message_id == sdk_gen2.MessageType.MP_HT_RESULT:\n    handtracking_data = converter.to_hand_pose(message)\n    # left/right hand detection and pose\n\n# VIO - visual-inertial odometry (device pose)\nelif message_id == sdk_gen2.MessageType.MP_VIO_RESULT:\n    vio_data = converter.to_vio_result(message)\n    # 6-DOF pose (rotation + translation)\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Wireless beacons:"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-python",children:"# Bluetooth beacons\nelif message_id == sdk_gen2.MessageType.BLE_BEACONS:\n    ble_beacons = converter.to_bluetooth_beacon(message)\n\n# WiFi access points\nelif message_id == sdk_gen2.MessageType.WIFI_BEACONS:\n    wifi_beacons = converter.to_wifi_beacon(message)\n"})}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h4,{id:"7-minimalsubscriber-class",children:"7. MinimalSubscriber Class"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-python",children:'class MinimalSubscriber(Node):\n    def __init__(self):\n        super().__init__("minimal_subscriber")\n        self.subscription = self.create_subscription(\n            AriaRaw, "aria_raw_message", self.listener_callback, 10\n        )\n        self.calib_sub = self.create_subscription(\n            String, "calibration", self.calib_callback, 10\n        )\n'})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"What happens during initialization:"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Creates ROS2 node"}),' named "minimal_subscriber"']}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Subscribes to two topics:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"aria_raw_message"}),": Raw sensor data (queue size: 10)"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"calibration"}),": Device calibration (queue size: 10)"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Registers callbacks"})," for each topic"]}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h4,{id:"8-listener-callback",children:"8. Listener Callback"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-python",children:"def listener_callback(self, msg):\n    if calibration_received:\n        raw_message_callback(msg)\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"What this does:"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Called for each AriaRaw message"})," received from publisher"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Waits for calibration"})," before processing (required for VIO/eye gaze/hand tracking)"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Delegates to raw_message_callback"})," for actual processing"]}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Why wait for calibration?"})," Some conversions (VIO, eye gaze, hand pose) require calibration data to properly transform coordinates."]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h4,{id:"9-calibration-callback",children:"9. Calibration Callback"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-python",children:'def calib_callback(self, msg):\n    global calibration_received\n\n    print("[Calibration] Received device calibration")\n\n    converter.set_calibration(msg.data)\n    calibration_received = True\n\n    print(\n        "[Calibration] Calibration set in converter - VIO, eye gaze, and hand pose decoding enabled"\n    )\n'})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"What this does:"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Receives calibration JSON string"})," from publisher"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Sets calibration in converter"})," - required for coordinate transformations"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Updates global flag"})," to enable message processing"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Logs confirmation"})," that calibration is ready"]}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"This runs once"})," (usually) when subscriber first starts or when late-joining"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h4,{id:"10-main-function",children:"10. Main Function"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-python",children:"def main(args=None):\n    rclpy.init(args=args)\n    minimal_subscriber = MinimalSubscriber()\n    rclpy.spin(minimal_subscriber)\n    minimal_subscriber.destroy_node()\n    rclpy.shutdown()\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Execution flow:"})}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Initialize ROS2"})," Python client library"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Create subscriber node"})," and register topic subscriptions"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Spin node"})," - processes incoming messages via callbacks"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Cleanup"})," when interrupted"]}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"data-flow",children:"Data Flow"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Publisher"})," connects to Aria device and starts streaming"]}),"\n",(0,r.jsxs)(s.li,{children:["Device sends calibration data \u2192 ",(0,r.jsx)(s.strong,{children:"Publisher"})," publishes to ",(0,r.jsx)(s.code,{children:"calibration"})," topic"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Subscriber"})," receives calibration \u2192 Sets up data converter"]}),"\n",(0,r.jsxs)(s.li,{children:["Device sends sensor data \u2192 ",(0,r.jsx)(s.strong,{children:"Publisher"})," receives via HTTP server"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Publisher"})," converts to ROS2 messages \u2192 Publishes to ",(0,r.jsx)(s.code,{children:"aria_raw_message"})," topic"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Subscriber"})," receives messages \u2192 Converts to typed data \u2192 Processes/displays"]}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,r.jsx)(s.h3,{id:"no-data-in-subscriber",children:"No Data in Subscriber"}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Problem:"})," Subscriber node runs but receives no messages."]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Solutions:"})}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Check publisher is running:"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"ros2 node list\n"})}),"\n",(0,r.jsxs)(s.p,{children:["Should show both ",(0,r.jsx)(s.code,{children:"minimal_publisher"})," and ",(0,r.jsx)(s.code,{children:"minimal_subscriber"})]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Check topics:"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"ros2 topic list\nros2 topic echo /aria_raw_message\n"})}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Verify Aria device connection:"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Ensure device is connected via USB"}),"\n",(0,r.jsx)(s.li,{children:"Check device is streaming (check publisher logs)"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h3,{id:"port-6768-already-in-use",children:"Port 6768 Already in Use"}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Problem:"})," Publisher fails to start HTTP server."]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Solutions:"})}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Check what's using the port:"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"sudo lsof -i :6768\n"})}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Kill existing process:"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"kill -9 <PID>\n"})}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Or change port in code:"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-python",children:"config.port = 6769  # Use different port\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h3,{id:"subscriber-not-processing-messages",children:"Subscriber Not Processing Messages"}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Problem:"})," Subscriber receives messages but doesn't process them."]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Reason:"})," Calibration not received yet. The subscriber waits for calibration before processing sensor data."]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Solution:"})," Ensure publisher successfully connects to device and sends calibration. Check publisher logs for calibration callback."]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h3,{id:"high-message-drop-rate",children:"High Message Drop Rate"}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Problem:"})," Some messages not being received."]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Solutions:"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Increase queue sizes"})," in publisher/subscriber"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Check network bandwidth"})," if using WiFi"]}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.strong,{children:"Reduce callback processing time"})}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Use wired USB connection"})," instead of wireless"]}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h3,{id:"publisher-and-subscriber-cannot-communicate",children:"Publisher and Subscriber Cannot Communicate"}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Problem:"})," Publisher and subscriber are running but not communicating (subscriber receives no messages)."]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Reason:"})," ROS2 nodes can only communicate if they're using the same ROS_DOMAIN_ID. By default, ROS2 uses domain ID 0, but if you have multiple ROS2 systems on the same network or have previously set a different domain ID, they may not be able to see each other."]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Solution:"})," Ensure both terminals use the same ROS_DOMAIN_ID:"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"# Terminal 1 (Subscriber)\nexport ROS_DOMAIN_ID=0\nsource install/setup.bash\nros2 run py_pubsub listener\n\n# Terminal 2 (Publisher)\nexport ROS_DOMAIN_ID=0\nsource install/setup.bash\nros2 run py_pubsub talker\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Check current domain ID:"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"echo $ROS_DOMAIN_ID\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Verify nodes can see each other:"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"ros2 node list\n"})}),"\n",(0,r.jsxs)(s.p,{children:["Should show both ",(0,r.jsx)(s.code,{children:"minimal_publisher"})," and ",(0,r.jsx)(s.code,{children:"minimal_subscriber"}),"."]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Note:"})," ROS_DOMAIN_ID can be any value from 0 to 101. Use different IDs to isolate different ROS2 systems on the same network."]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"related-resources",children:"Related Resources"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.a,{href:"https://docs.ros.org/en/foxy/Tutorials/Beginner-Client-Libraries/Single-Package-Define-And-Use-Interface.html",children:"ROS2 Custom Messages Tutorial"})}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.a,{href:"https://docs.ros.org/en/foxy/Tutorials/Beginner-Client-Libraries/Writing-A-Simple-Py-Publisher-And-Subscriber.html",children:"ROS2 Python Publisher/Subscriber Tutorial"})}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.a,{href:"/ark/client-sdk/python-sdk/streaming-example",children:"Streaming Example"})}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,a.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},28453(e,s,n){n.d(s,{R:()=>l,x:()=>t});var i=n(96540);const r={},a=i.createContext(r);function l(e){const s=i.useContext(a);return i.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function t(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),i.createElement(a.Provider,{value:s},e.children)}}}]);