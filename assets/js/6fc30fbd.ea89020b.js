"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[153],{14827:(e,s,i)=>{i.r(s),i.d(s,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"ARK/sdk/samples/streaming_subscribe","title":"Streaming Subscription","description":"Overview","source":"@site/docs/ARK/sdk/samples/streaming_subscribe.mdx","sourceDirName":"ARK/sdk/samples","slug":"/ARK/sdk/samples/streaming_subscribe","permalink":"/projectaria_tools/docs/ARK/sdk/samples/streaming_subscribe","draft":false,"unlisted":false,"editUrl":"https://github.com/facebookresearch/projectaria_tools/tree/main/website/docs/ARK/sdk/samples/streaming_subscribe.mdx","tags":[],"version":"current","sidebarPosition":40,"frontMatter":{"sidebar_position":40,"title":"Streaming Subscription"},"sidebar":"tutorialSidebar","previous":{"title":"Recording","permalink":"/projectaria_tools/docs/ARK/sdk/samples/device_recording"},"next":{"title":"Streaming and Visualizing All Live Sensor Data","permalink":"/projectaria_tools/docs/ARK/sdk/samples/device_stream"}}');var n=i(74848),r=i(28453),t=i(98180);const l={sidebar_position:40,title:"Streaming Subscription"},o="Subscribe to Aria Streaming Data",c={},d=[{value:"Overview",id:"overview",level:2},{value:"Stream and subscribe examples",id:"stream-and-subscribe-examples",level:2},{value:"Example 1: Stream and subscribe over USB",id:"example-1-stream-and-subscribe-over-usb",level:3},{value:"Example 2: Using Wi-Fi",id:"example-2-using-wi-fi",level:3},{value:"Example 3: Stream and subscribe in hotspot mode",id:"example-3-stream-and-subscribe-in-hotspot-mode",level:3},{value:"Code walkthrough",id:"code-walkthrough",level:3},{value:"1. Configure the subscription",id:"1-configure-the-subscription",level:4},{value:"2. Set message queue size",id:"2-set-message-queue-size",level:4},{value:"3. Set streaming security options",id:"3-set-streaming-security-options",level:4},{value:"4. Create an StreamingClient observer and attach it",id:"4-create-an-streamingclient-observer-and-attach-it",level:4},{value:"5. Start subscribing and listen to the live stream",id:"5-start-subscribing-and-listen-to-the-live-stream",level:4},{value:"6. Visualize the live stream",id:"6-visualize-the-live-stream",level:4},{value:"7. Unsubscribe from the stream and free resources",id:"7-unsubscribe-from-the-stream-and-free-resources",level:3}];function m(e){const s={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.header,{children:(0,n.jsx)(s.h1,{id:"subscribe-to-aria-streaming-data",children:"Subscribe to Aria Streaming Data"})}),"\n",(0,n.jsx)(s.h2,{id:"overview",children:"Overview"}),"\n",(0,n.jsxs)(s.p,{children:["This ",(0,n.jsx)(s.code,{children:"streaming_subscribe"})," example shows how to subscribe to and unsubscribe from a streaming session as well as visualize the live stream, using the ",(0,n.jsx)(s.a,{href:"/docs/ARK/sdk",children:"Project Aria Client SDK"}),"."]}),"\n",(0,n.jsx)(s.h2,{id:"stream-and-subscribe-examples",children:"Stream and subscribe examples"}),"\n",(0,n.jsx)(s.h3,{id:"example-1-stream-and-subscribe-over-usb",children:"Example 1: Stream and subscribe over USB"}),"\n",(0,n.jsxs)(s.p,{children:["In this example, the CLI is used to initiate streaming and the Client SDK is used to subscribe to the stream. To find out how to start streaming using the SDK, go to ",(0,n.jsx)(s.a,{href:"/docs/ARK/sdk/samples/device_stream",children:"Streaming Sensor Data"}),"."]}),"\n",(0,n.jsxs)(s.ol,{children:["\n",(0,n.jsx)(s.li,{children:"Plug your Aria glasses into your computer, using the provided cable"}),"\n",(0,n.jsx)(s.li,{children:"From the samples directory in Terminal, run:"}),"\n"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-bash",children:"aria streaming start --interface usb --use-ephemeral-certs\n"})}),"\n",(0,n.jsxs)(s.ol,{start:"3",children:["\n",(0,n.jsx)(s.li,{children:"Wait for the stream to start then run:"}),"\n"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-bash",children:"python -m streaming_subscribe\n"})}),"\n",(0,n.jsx)(s.p,{children:"You should then see:"}),"\n",(0,n.jsx)("div",{style:{textAlign:"center"},children:(0,n.jsx)("img",{src:(0,t.default)("img/ARK/sdk/streaming_subscribe.png"),alt:"Aria Live Stream Window"})}),"\n",(0,n.jsxs)(s.ol,{start:"4",children:["\n",(0,n.jsx)(s.li,{children:"There are several ways you can stop streaming:"}),"\n"]}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:"Press q or ESC to quit the app"}),"\n",(0,n.jsx)(s.li,{children:"Use Ctrl-C to terminate in terminal"}),"\n",(0,n.jsx)(s.li,{children:"Press the Capture button on your glasses"}),"\n"]}),"\n",(0,n.jsx)(s.h3,{id:"example-2-using-wi-fi",children:"Example 2: Using Wi-Fi"}),"\n",(0,n.jsxs)(s.p,{children:["To use Wi-Fi to initiate streaming or to stream data, alter the ",(0,n.jsx)(s.code,{children:"aria streaming start --interface usb --use-ephemeral-certs"})," command."]}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:["To stream data over Wi-Fi, use ",(0,n.jsx)(s.code,{children:"--interface wifi"})]}),"\n",(0,n.jsxs)(s.li,{children:["To initiate streaming over Wi-Fi, add ",(0,n.jsx)(s.code,{children:"--device-ip <glasses IP>"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:["Open the Mobile Companion app and tap ",(0,n.jsx)(s.a,{href:"/docs/ARK/mobile_companion_app#dashboard",children:"Wi-Fi on the Dashboard"})," to see your glasses' IP address"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(s.h3,{id:"example-3-stream-and-subscribe-in-hotspot-mode",children:"Example 3: Stream and subscribe in hotspot mode"}),"\n",(0,n.jsx)(s.p,{children:"In this example, the CLI is used to initiate streaming and the Client SDK is used to subscribe to the stream."}),"\n",(0,n.jsxs)(s.ol,{children:["\n",(0,n.jsx)(s.li,{children:"From the samples directory in Terminal, run:"}),"\n"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-bash",children:"aria streaming start --interface hotspot --use-ephemeral-certs\n"})}),"\n",(0,n.jsxs)(s.ol,{start:"2",children:["\n",(0,n.jsxs)(s.li,{children:["\n",(0,n.jsx)(s.p,{children:"Wait for the stream to start: once it does, it should display the details of the hotspot connection. Go to the Wi-Fi settings on your computer and connect to the glasses' hotspot connection using the printed SSID and passphrase information."}),"\n"]}),"\n",(0,n.jsxs)(s.li,{children:["\n",(0,n.jsx)(s.p,{children:"Run the below command to subscribe to the streamed data:"}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-bash",children:"python -m streaming_subscribe --update_iptables\n"})}),"\n",(0,n.jsxs)(s.ol,{start:"4",children:["\n",(0,n.jsx)(s.li,{children:"There are several ways you can stop streaming:"}),"\n"]}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:"Use Ctrl-C to terminate in Terminal."}),"\n",(0,n.jsx)(s.li,{children:"Press the Capture button on your glasses."}),"\n"]}),"\n",(0,n.jsx)(s.h3,{id:"code-walkthrough",children:"Code walkthrough"}),"\n",(0,n.jsx)(s.h4,{id:"1-configure-the-subscription",children:"1. Configure the subscription"}),"\n",(0,n.jsxs)(s.p,{children:["Use ",(0,n.jsx)(s.code,{children:"subscriber_data_type"})," attribute to set the type of data the client subscribes to."]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-python",children:"config = streaming_client.subscription_config\nconfig.subscriber_data_type = (\n    aria.StreamingDataType.Rgb | aria.StreamingDataType.Slam\n)\n"})}),"\n",(0,n.jsx)(s.h4,{id:"2-set-message-queue-size",children:"2. Set message queue size"}),"\n",(0,n.jsx)(s.p,{children:"The message queue size determines how many recent frames will be retained. A smaller queue size is utilized to process only the most recent data."}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-python",children:"config.message_queue_size[aria.StreamingDataType.Rgb] = 1\nconfig.message_queue_size[aria.StreamingDataType.Slam] = 1\n"})}),"\n",(0,n.jsx)(s.h4,{id:"3-set-streaming-security-options",children:"3. Set streaming security options"}),"\n",(0,n.jsxs)(s.p,{children:["Security options are set to use ephemeral certificates through a ",(0,n.jsx)(s.code,{children:"StreamingSecurityOptions"})," instance. Go to ",(0,n.jsx)(s.a,{href:"/docs/ARK/sdk/concepts/streaming_internals",children:"the Streaming Internals page"})," for various aspects of streaming security and how certificates are used."]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-python",children:"options = aria.StreamingSecurityOptions()\noptions.use_ephemeral_certs = True\nconfig.security_options = options\n"})}),"\n",(0,n.jsx)(s.h4,{id:"4-create-an-streamingclient-observer-and-attach-it",children:"4. Create an StreamingClient observer and attach it"}),"\n",(0,n.jsxs)(s.p,{children:["Find more description of observer in the ",(0,n.jsx)(s.a,{href:"http://localhost:3000/projectaria_tools/docs/ARK/sdk/samples/device_stream#3-write-callbacks-for-each-sensor-data-stream",children:"streaming code sample"})]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-python",children:"class StreamingClientObserver:\n    def __init__(self):\n        self.images = {}\n\n    def on_image_received(self, image: np.array, record: ImageDataRecord):\n        self.images[record.camera_id] = image\n\nobserver = StreamingClientObserver()\nstreaming_client.set_streaming_client_observer(observer)\n"})}),"\n",(0,n.jsx)(s.h4,{id:"5-start-subscribing-and-listen-to-the-live-stream",children:"5. Start subscribing and listen to the live stream"}),"\n",(0,n.jsx)(s.p,{children:"The client begins listening for incoming streaming data from the subscribed data types."}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-python",children:"streaming_client.subscribe()\n"})}),"\n",(0,n.jsx)(s.h4,{id:"6-visualize-the-live-stream",children:"6. Visualize the live stream"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:"RGB and SLAM images are visualized in separate windows using OpenCV. The images are processed and displayed the streaming stops or the application quit. We rotate the image and stack the SLAM images so that they are shown in a single window."}),"\n"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-python",children:"while not quit_keypress():\n    # Render the RGB image\n    if aria.CameraId.Rgb in observer.images:\n        rgb_image = np.rot90(observer.images[aria.CameraId.Rgb], -1)\n        rgb_image = cv2.cvtColor(rgb_image, cv2.COLOR_BGR2RGB)\n        cv2.imshow(rgb_window, rgb_image)\n        del observer.images[aria.CameraId.Rgb]\n\n    # Stack and display the SLAM images\n    if (\n        aria.CameraId.Slam1 in observer.images\n        and aria.CameraId.Slam2 in observer.images\n    ):\n        slam1_image = np.rot90(observer.images[aria.CameraId.Slam1], -1)\n        slam2_image = np.rot90(observer.images[aria.CameraId.Slam2], -1)\n        cv2.imshow(slam_window, np.hstack((slam1_image, slam2_image)))\n        del observer.images[aria.CameraId.Slam1]\n        del observer.images[aria.CameraId.Slam2]\n"})}),"\n",(0,n.jsx)(s.admonition,{type:"note",children:(0,n.jsx)(s.p,{children:"Cameras on Aria glasses are installed sideways. The visualizer rotates the raw image data for a more natural view."})}),"\n",(0,n.jsx)(s.h3,{id:"7-unsubscribe-from-the-stream-and-free-resources",children:"7. Unsubscribe from the stream and free resources"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:"Unsubscribing stops the client from listening to streaming data and cleans up resources."}),"\n"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-python",children:"streaming_client.unsubscribe()\n"})})]})}function h(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,n.jsx)(s,{...e,children:(0,n.jsx)(m,{...e})}):m(e)}},28453:(e,s,i)=>{i.d(s,{R:()=>t,x:()=>l});var a=i(96540);const n={},r=a.createContext(n);function t(e){const s=a.useContext(r);return a.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:t(e.components),a.createElement(r.Provider,{value:s},e.children)}}}]);